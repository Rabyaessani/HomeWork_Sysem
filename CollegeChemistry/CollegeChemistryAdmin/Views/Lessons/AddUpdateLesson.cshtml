@model CollegeChemistryLibrary.Entities.Lessons
@{
    ViewData["Title"] = "Add Blog";
    Layout = "~/Views/Shared/_Layout.cshtml";

    string LessonForm_ActionMethod = "";



    int? Lessonid = ViewBag.LessonId;
    if (Lessonid.HasValue && Lessonid.Value != 0)
    {
        LessonForm_ActionMethod = "UpdateLesson";
    }
    else
    {
        LessonForm_ActionMethod = "InsertLesson";
    }
    // Initialize model if it's null
    var LessonModel = Model ?? new CollegeChemistryLibrary.Entities.Lessons();
}
@section CSS {
    <link rel="stylesheet" href="~/css/Form.css">
}
<div class="d-flex align-items-center justify-content-between mb-4">
    <h1 class="mb-8"> @(Lessonid == 0 ? "Add Lesson" : "Update Lesson")</h1>
</div>

<div id="errorAlert" class="alert alert-danger alert-dismissible fade show" style="display: none;">
    <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
    <strong>Error!</strong> <span id="errorMessage"></span>
</div>

<div class="page-wrapper">
    <div class="content">
        <div class="row justify-content-center">
            <div class="col-lg-8 col-md-10 col-sm-12">
                <!-- Card -->
                <div class="card">
                    <div class="card-body">
                        <form id="yourFormId" enctype="multipart/form-data" method="post" asp-area="" asp-controller="Lessons" asp-action="@LessonForm_ActionMethod">
                            <fieldset id="first-field">
                                <div class="row">
                                    <div class="col-md-12 mb-2" hidden>
                                        <div class="form-group">
                                            <label for="id">Lesson Id</label>
                                            <input type="text" class="form-control" id="LessonId" name="id" value="@LessonModel.id"  readonly>
                                        </div>
                                    </div>

                                    <div class="col-md-12 mb-2" hidden>
                                        <div class="form-group">
                                            <label for="created_at">Created At</label>
                                            <input type="text" class="form-control" id="created_at" name="created_at" value="@LessonModel.created_at"  readonly>
                                        </div>
                                    </div>
                                    <div class="col-md-12 mb-4">
                                        <div class="form-group">
                                            <label for="category_id">Category Type</label>
                                            <select required class="form-control" name="category_id" asp-items="@(new SelectList(ViewBag.List, "id", "category_name",LessonModel.category_id))">
                                                <option value="" disabled selected>Select</option>

                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-12 mb-2">
                                        <div class="form-group">
                                            <label for="title">Lesson Title</label>
                                            <input type="text" class="form-control" id="lessonTitle" placeholder="Enter Title" name="title" value="@LessonModel.title" required>
                                        </div>
                                    </div>

                                    <div class="col-md-12 mb-2">
                                        <div class="form-group">
                                            <label for="description">Lesson Description</label>
                                            <textarea class="form-control" id="LessonDesc" placeholder="Enter Description" name="description" rows="6" required>@LessonModel.description</textarea>
                                        </div>
                                    </div>

                                    <div class="col-md-12 mb-2">
                                        <div class="form-group">
                                            <label for="content">Lesson Content</label>
                                            <textarea class="form-control" id="LessonContent" placeholder="Enter Content" name="content" rows="5" required>@LessonModel.content</textarea>
                                        </div>
                                    </div>

                                    <div class="col-md-12 mb-2">
                                        <div class="form-group">
                                            <label for="youtube_video">Youtube Video Link</label>
                                            <input type="text" class="form-control" id="youtube_video" placeholder="Enter Video link" name="youtube_video" value="@LessonModel.youtube_video" required>
                                        </div>
                                    </div>
                                </div>

                                <div class="sub-title mb-3">
                                    <h6>Cover Picture</h6>
                                </div>

                                <div class="form-uploads mb-4">
                                    <div class="form-uploads-path text-center">
                                        <img src="~/assets/img/upload.svg" alt="img" class="mb-3">
                                        <div class="file-browse">
                                            <h6>Drag & drop image or </h6>
                                            <div class="file-browse-path mt-3">
                                                <input name="coverPicture" type="file" class="form-control-file" value="@LessonModel.cover_picture">
                                                @* <a href="javascript:void(0);" class="btn btn-link"> Browse</a> *@
                                            </div>
                                        </div>

                                    </div>
                                </div>
                                @{
                                    if (Lessonid != 0)
                                    {
                                        <div class="file-preview mb-4">
                                            <ul class="list-unstyled">
                                                @if (LessonModel.cover_picture != null && LessonModel.cover_picture.Length > 0)
                                                {
                                                    <img src="data:image/png;base64,@Convert.ToBase64String(LessonModel.cover_picture)" alt="Cover Picture" style="max-width: 150px;" name="cover_picture" />
                                                }
                                                else
                                                {
                                                    <span>No Cover Picture</span>
                                                }
                                            </ul>
                                        </div>
                                    }
                                }
                                @{
                                    <div class="text-center">
                                        <button type="submit" class="btn btn-primary">
                                            @(Lessonid == 0 ? "Add Lesson" : "Update Lesson")
                                        </button>
                                    </div>
                                }
                            </fieldset>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <!-- CKEditor CDN -->
    <!-- Initialize CKEditor -->
 <script>
        CKEDITOR.replace('LessonContent');

        document.getElementById('yourFormId').addEventListener('submit', function (e) {
            // Get the CKEditor instance
            var editorData = CKEDITOR.instances.LessonContent.getData();

            // Check if the editor content is empty
            if (editorData.trim() === '') {
                // Show the alert message
                document.getElementById('errorAlert').style.display = 'block';
                document.getElementById('errorMessage').innerText = 'Lesson Content is required.';
                e.preventDefault(); // Prevent form submission
            }
        });
    </script>
}

